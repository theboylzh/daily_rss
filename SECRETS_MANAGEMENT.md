# Secrets管理指南

本指南详细说明如何安全地管理Daily RSS工具的Secrets（密钥和敏感信息），确保它们不会被泄漏或滥用。

## 1. 什么是Secrets？

Secrets是指项目中需要使用的敏感信息，包括：
- AI模型的API密钥
- 邮箱账号和密码
- Tavily搜索的API密钥

这些信息如果被公开，可能会导致安全风险，因此需要特殊处理。

## 2. 本地开发环境

### 2.1 使用.env文件

在本地开发环境中，使用`.env`文件存储Secrets：

1. **复制模板文件**：
   ```bash
   cp .env.example .env
   ```

2. **填写实际值**：
   编辑`.env`文件，填写实际的API密钥和邮箱信息。

3. **保护.env文件**：
   - 确保`.env`文件已添加到`.gitignore`中
   - 不要将`.env`文件提交到版本控制系统
   - 定期更新API密钥和密码

### 2.2 环境变量优先级

配置加载优先级（从高到低）：
1. 系统环境变量
2. `.env`文件中的变量
3. `config.py`中的默认值

## 3. GitHub Actions部署

### 3.1 配置GitHub Secrets

在GitHub仓库中，Secrets通过以下步骤设置：

1. **进入Secrets设置**：
   - 打开GitHub仓库
   - 点击「Settings」>「Secrets and variables」>「Actions」

2. **添加Secrets**：
   点击「New repository secret」添加以下Secrets：

   | Secret名称 | 描述 | 必需 |
   |-----------|------|------|
   | `AI_API_KEY` | AI模型的API密钥（如DeepSeek） | ✓ |
   | `EMAIL_SENDER` | 发送邮件的邮箱地址 | ✓ |
   | `EMAIL_RECEIVER` | 接收邮件的邮箱地址 | ✓ |
   | `EMAIL_PASSWORD` | 发送邮件的邮箱密码（建议使用应用密码） | ✓ |
   | `TAVILY_API_KEY` | Tavily搜索的API密钥（可选） | ✗ |

### 3.2 Secrets安全最佳实践

- **使用应用密码**：对于邮箱，使用应用密码而不是主密码
- **定期轮换**：定期更新API密钥和密码
- **最小权限**：为API密钥设置最小必要的权限
- **审计访问**：定期检查Secrets的使用情况
- **加密存储**：确保Secrets在传输和存储过程中都被加密

## 4. 邮箱应用密码设置

为了安全起见，建议使用邮箱的应用密码而不是主密码：

### 4.1 163邮箱设置

1. **登录163邮箱**
2. **进入设置**：点击顶部导航栏中的「设置」
3. **开启SMTP服务**：
   - 选择「POP3/SMTP/IMAP」
   - 开启「IMAP/SMTP服务」
   - 点击「保存更改」
4. **设置客户端授权密码**：
   - 点击「客户端授权密码」
   - 按照提示设置授权密码
   - 保存生成的授权密码（这将是你的`EMAIL_PASSWORD`）

### 4.2 Gmail设置

1. **登录Gmail**
2. **进入账户设置**：
   - 点击右上角的头像
   - 选择「管理您的Google账户」
3. **进入安全性设置**：
   - 选择左侧菜单中的「安全性」
   - 向下滚动到「应用密码」
4. **创建应用密码**：
   - 点击「应用密码」
   - 选择应用：「邮件」
   - 选择设备：「其他」
   - 输入设备名称（如「Daily RSS」）
   - 点击「生成」
   - 保存生成的应用密码（这将是你的`EMAIL_PASSWORD`）

### 4.3 其他邮箱

大多数现代邮箱服务都支持应用密码功能，请参考对应邮箱的帮助文档。

## 5. 常见问题与解决方案

### 5.1 Secrets配置错误

**症状**：GitHub Actions工作流执行失败，提示缺少Secrets。

**解决方案**：
- 检查Secrets名称是否正确（区分大小写）
- 确保所有必需的Secrets都已设置
- 验证Secrets值是否正确

### 5.2 邮箱密码认证失败

**症状**：邮件发送失败，提示认证错误。

**解决方案**：
- 确保使用的是应用密码而不是主密码
- 检查邮箱的SMTP服务是否已开启
- 验证邮箱地址和密码是否正确

### 5.3 API密钥失效

**症状**：AI分析失败，提示API密钥无效。

**解决方案**：
- 检查API密钥是否已过期
- 验证API密钥的权限是否足够
- 检查API密钥的使用频率是否超过限制

## 6. 安全审计与监控

### 6.1 定期审计

- **Secrets审计**：每季度检查一次所有Secrets的状态
- **访问日志**：检查API密钥的使用日志，寻找异常活动
- **权限审查**：确保API密钥只具有必要的权限

### 6.2 异常检测

- **使用频率监控**：设置API调用频率的警报
- **异常位置**：监控来自异常位置的API调用
- **异常模式**：检测异常的API调用模式

## 7. 紧急情况处理

### 7.1 密钥泄漏

如果怀疑API密钥或密码被泄漏：

1. **立即轮换**：立即生成新的API密钥或密码
2. **更新配置**：在所有使用该密钥的地方更新为新密钥
3. **撤销旧密钥**：如果可能，撤销旧的API密钥
4. **审计**：检查密钥的使用历史，寻找可能的滥用

### 7.2 邮箱被滥用

如果怀疑邮箱被滥用：

1. **更改密码**：立即更改邮箱密码
2. **检查授权**：查看邮箱的授权应用列表，移除可疑应用
3. **启用双因素认证**：为邮箱启用双因素认证
4. **联系服务提供商**：如果情况严重，联系邮箱服务提供商

## 8. 最佳实践总结

1. **永远不要**在代码中硬编码敏感信息
2. **使用**环境变量或Secrets管理工具存储敏感信息
3. **定期轮换**API密钥和密码
4. **使用**应用密码而不是主密码
5. **启用**双因素认证
6. **监控**API使用情况
7. **教育**团队成员关于Secrets安全的重要性
8. **备份**Secrets（使用安全的密码管理器）

通过遵循这些最佳实践，你可以确保Daily RSS工具的Secrets得到安全管理，避免安全风险和潜在的损失。
