# Daily RSS 工具PRD文档

## 1. 产品概述

### 1.1 产品背景
用户希望开发一个简易的RSS工具，用于抓取多个订阅源的最新新闻，通过AI进行分析，并以美观的形式推送到用户指定的平台，帮助用户快速了解互联网技术、AI发展、商业、金融、政治政策方面的信息，以便做出决策。

### 1.2 产品目标
- 自动抓取多个订阅源的最新新闻
- 通过AI对新闻内容进行分析，提取关键信息和趋势
- 以美观的形式推送到用户邮箱
- 支持定时自动化操作
- 提供周回顾和月回顾功能
- 高效管理数据，控制token消耗
- 提供HTML预览功能，方便用户查看生成结果

### 1.3 目标用户
个人用户，主要使用场景是快速了解各领域的重要信息，辅助决策，避免花费大量时间阅读原始新闻。

## 2. 功能模块

### 2.1 核心功能

#### 2.1.1 订阅源管理
- 支持OPML文档导入
- 支持手动添加/删除订阅源
- 支持不同格式的订阅源（Atom、RSS 1.0/2.0）
- 订阅源更新频率：每日更新

#### 2.1.2 新闻抓取
- 抓取多个订阅源24小时内的最新新闻
- 支持去重功能
- 保留2个月的新闻抓取数据

#### 2.1.3 AI分析
- **第一层分析**：总结今日发生的事情和趋势，包括政治时事、宏观经济、行业动态、科技新闻等
- **第二层分析**：对关键事件进行深度分析，包括客观事实、整体观点、事情发生原因、后续发展预测、个体应对建议
- **第三层分析**：综合分析和洞察建议，包括思维启发、投资建议、个人提升、机遇与风险
- 支持并行分析，提高效率
- 支持自定义分析框架和提示词
- 优先使用国产AI模型（如DeepSeek等）
- 集成Tavily搜索，增强事件分析的深度和准确性

#### 2.1.4 推送功能
- 默认邮箱推送（theboylzh@163.com）
- 支持每天固定时间推送（如早上八点）
- 推送内容为美观的HTML格式（极简主义风格，色彩低饱和护眼）
- HTML内容包含完整的三层分析架构和新闻列表

#### 2.1.5 自动化操作
- 支持定时任务（每日、每周、每月）
- 考虑使用云服务（如GitHub Actions）实现稳定的定时执行

#### 2.1.6 数据管理
- 每日AI分析数据保留2个月，之后自动删除
- 每周和每月的分析数据一直保留
- 每周一进行周回顾分析
- 每月第一天进行月回顾分析
- 考虑token消耗

#### 2.1.7 HTML预览功能
- 基于已有的分析数据生成HTML预览
- 支持选择特定日期的分析数据
- 生成的HTML文件可在浏览器中直接查看

### 2.2 辅助功能
- 数据去重
- 数据存储管理
- 错误处理和日志记录
- 详细的命令行界面和帮助信息

## 3. 技术架构

### 3.1 技术栈
- 开发语言：Python 3.10+
- 核心库：
  - feedparser：解析RSS/Atom订阅源
  - requests：网络请求
  - BeautifulSoup4：HTML解析
  - openai：AI模型接口
  - smtplib：邮件发送
  - schedule：定时任务（本地）
  - GitHub Actions：云定时任务
  - python-dotenv：环境变量管理
  - pydantic_settings：配置管理
  - tavily-python：增强AI分析
- 数据存储：JSON文件

### 3.2 系统架构

#### 3.2.1 模块划分
1. **订阅源管理模块**：负责导入、添加、删除订阅源
2. **新闻抓取模块**：负责定时抓取新闻，去重，存储
3. **AI分析模块**：负责调用AI模型进行新闻分析，包括三层分析架构
4. **推送模块**：负责将分析结果推送到邮箱，生成HTML内容
5. **自动化模块**：负责定时触发各模块任务
6. **数据管理模块**：负责数据存储、清理和回顾分析
7. **预览模块**：负责基于已有分析数据生成HTML预览

#### 3.2.2 数据流
1. 订阅源管理模块 → 新闻抓取模块：提供订阅源列表
2. 新闻抓取模块 → 数据管理模块：存储抓取的新闻
3. 数据管理模块 → AI分析模块：提供待分析的新闻
4. AI分析模块 → 数据管理模块：存储分析结果（三层分析架构）
5. 数据管理模块 → 推送模块：提供待推送的分析内容
6. 推送模块 → 用户：发送邮件
7. 自动化模块 → 各模块：定时触发任务
8. 数据管理模块 → 预览模块：提供已有分析数据
9. 预览模块 → 用户：生成HTML预览文件

### 3.3 部署方案

#### 3.3.1 本地部署
- 适用于Mac电脑
- 使用Python脚本执行
- 定时任务：使用schedule库或Mac自带的自动化工具

#### 3.3.2 云部署
- 使用GitHub Actions实现定时任务
- 优势：无需本地电脑24小时开机
- 实现简单，快速部署

## 4. 数据结构

### 4.1 订阅源数据
```json
{
  "sources": [
    {
      "id": "unique_id",
      "name": "订阅源名称",
      "url": "订阅源URL",
      "type": "rss/atom",
      "last_updated": "2023-01-01T00:00:00Z"
    }
  ]
}
```

### 4.2 新闻数据
```json
[
  {
    "id": "unique_id",
    "title": "新闻标题",
    "url": "新闻URL",
    "content": "新闻内容",
    "source": "订阅源名称",
    "published_at": "2023-01-01T00:00:00Z",
    "collected_at": "2023-01-01T00:00:00Z"
  }
]
```

### 4.3 分析结果数据（三层架构）
```json
{
  "date": "2023-01-01",
  "first_layer": "第一层分析内容（整体摘要）",
  "second_layer": ["事件1分析内容", "事件2分析内容", "事件3分析内容"],
  "third_layer": "第三层分析内容（综合洞察）",
  "daily_summary": "每日总结内容",
  "event_analysis": "事件分析内容",
  "detailed_analysis": ["详细分析1", "详细分析2", "详细分析3"],
  "timestamp": "2023-01-01T00:00:00Z",
  "news_count": 100
}
```

### 4.4 周回顾数据
```json
{
  "week": "2023-W01",
  "summary": "周回顾内容",
  "timestamp": "2023-01-01T00:00:00Z",
  "news_count": 700
}
```

### 4.5 月回顾数据
```json
{
  "month": "2023-01",
  "summary": "月回顾内容",
  "timestamp": "2023-01-01T00:00:00Z",
  "news_count": 3000
}
```

## 5. 界面设计

### 5.1 界面概述
本产品不需要图形界面，采用命令行方式运行。

### 5.2 配置文件
通过配置文件进行设置，包括：
- 订阅源列表
- AI模型配置
- 推送设置
- 定时任务设置

### 5.3 HTML预览
生成的HTML预览文件具有以下特点：
- 极简主义风格，色彩低饱和护眼
- 清晰的三层分析结构
- 响应式设计，适配不同设备
- 美观的排版和布局

## 6. 技术实现方案

### 6.1 核心模块实现

#### 6.1.1 订阅源管理
- 使用feedparser库解析OPML文档
- 提供函数添加/删除订阅源
- 支持多种格式的订阅源
- 存储订阅源信息到JSON文件

#### 6.1.2 新闻抓取
- 使用feedparser库抓取新闻
- 基于URL和标题进行去重
- 存储到JSON文件中
- 实现错误处理和重试机制

#### 6.1.3 AI分析
- 使用并行处理（如multiprocessing库）实现并行分析
- 支持自定义分析框架和提示词
- 调用AI模型API进行分析
- 集成Tavily搜索增强分析深度
- 实现三层分析架构：
  1. 第一层：整体摘要分析
  2. 第二层：关键事件深度分析
  3. 第三层：综合洞察和建议

#### 6.1.4 推送功能
- 使用smtplib库发送邮件
- 生成美观的HTML格式内容
- 支持固定时间推送
- 实现错误处理和重试机制

#### 6.1.5 自动化操作
- 本地：使用schedule库实现定时任务
- 云端：使用GitHub Actions实现定时任务
- 提供命令行接口手动触发任务

#### 6.1.6 数据管理
- 使用JSON文件存储数据
- 实现数据清理功能（删除2个月前的每日分析数据）
- 实现周回顾和月回顾功能
- 提供数据备份建议

#### 6.1.7 HTML预览功能
- 基于已有分析数据生成HTML预览
- 支持选择特定日期的分析数据
- 生成的HTML文件可在浏览器中直接查看

### 6.2 部署方案

#### 6.2.1 本地部署
1. 安装依赖：`pip install -r requirements.txt`
2. 配置环境变量：复制`.env.example`为`.env`并填写相关配置
3. 配置订阅源：在`config.py`中添加或通过命令行添加
4. 运行主脚本：`python main.py`

#### 6.2.2 云部署
1. 将代码上传到GitHub仓库
2. 配置GitHub Actions workflow文件，设置定时任务
3. 配置环境变量（如API密钥、邮箱密码等）
4. 启用GitHub Actions，系统会自动按照配置的时间执行任务

## 7. 风险评估

### 7.1 潜在风险
1. **AI模型API限制**：可能存在请求频率限制或token消耗过高的问题
2. **网络不稳定**：可能导致新闻抓取失败
3. **本地电脑关机**：可能导致定时任务无法执行
4. **数据存储问题**：可能出现数据丢失或损坏
5. **Tavily API限制**：可能存在请求频率限制或API密钥失效的问题

### 7.2 风险对策
1. **AI模型API限制**：
   - 实现API调用重试机制
   - 控制每次分析的新闻数量
   - 监控token消耗
   - 优先使用响应速度快、稳定性高的模型

2. **网络不稳定**：
   - 实现网络请求重试机制
   - 记录失败的抓取任务，待网络恢复后重试
   - 提供详细的错误日志

3. **本地电脑关机**：
   - 推荐使用GitHub Actions等云服务实现定时任务
   - 本地定时任务增加容错机制

4. **数据存储问题**：
   - 实现数据备份机制
   - 使用JSON文件存储，便于检查和修复
   - 定期清理过期数据，减少存储压力

5. **Tavily API限制**：
   - 实现API调用重试机制
   - 控制搜索频率和深度
   - 提供备用分析方案

## 8. 项目计划

### 8.1 开发阶段
1. **准备阶段**：搭建开发环境，安装依赖
2. **核心功能开发**：实现订阅源管理、新闻抓取、AI分析、推送功能
3. **自动化实现**：实现定时任务和数据管理
4. **预览功能开发**：实现HTML预览功能
5. **测试阶段**：测试各功能模块，确保正常运行
6. **部署阶段**：部署到本地或云服务

### 8.2 时间估计
- 准备阶段：1天
- 核心功能开发：3-5天
- 自动化实现：2天
- 预览功能开发：1天
- 测试阶段：1-2天
- 部署阶段：1天

## 9. 后续建议

1. **扩展功能**：
   - 支持更多推送方式（如Telegram、飞书等）
   - 增加数据分析和可视化功能
   - 支持更多AI模型和分析维度
   - 实现Web界面，提供更直观的操作体验

2. **优化方向**：
   - 进一步优化AI分析的准确性和效率
   - 减少token消耗
   - 提高系统稳定性和容错能力
   - 优化HTML生成和邮件推送的性能

3. **维护建议**：
   - 定期更新依赖库
   - 监控系统运行状态
   - 及时调整订阅源和分析策略
   - 关注AI模型的更新和优化

## 10. 总结

本PRD文档详细描述了Daily RSS工具的需求和实现方案，包括核心功能、技术架构、数据结构、部署方案等。该工具将帮助用户快速了解各领域的重要信息，辅助决策，避免花费大量时间阅读原始新闻。

通过Python实现，具有简单、高效、易用的特点，同时考虑了系统的稳定性和扩展性。核心亮点包括：

- **三层分析架构**：提供全面、深入的新闻分析
- **Tavily搜索集成**：增强分析深度和准确性
- **美观的HTML推送**：提供良好的阅读体验
- **HTML预览功能**：方便用户查看生成结果
- **灵活的部署选项**：支持本地和云端部署
- **完善的自动化**：支持定时任务和手动触发

该工具已经实现了所有核心功能，并经过了测试验证，可以为用户提供稳定、可靠的新闻分析服务。